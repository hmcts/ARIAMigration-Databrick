parameters:
- name: configureCluster
  type: boolean
  default: true
- name: env
  displayName: Environment
  type: string
  default: 'sbox'
  values:
  - sbox
  - test
  - staging
- name: databricksClusterId
  displayName: Databricks Cluster ID
  type: string
  default: '1121-123925-fa7rrd19'

name: ARIA Data Migration CI Pipeline - ${{ parameters.env }}
trigger:
- master

variables:
  resourceGroupName: ingest00-main-${{ parameters.env }}
  agentPool: "ubuntu-latest"

stages:
  - stage: DeploySbox
    displayName: Deploy to Sandbox
    jobs:
    - template: pipeline/jobs/configure.yaml
      displayName: Configure
      parameters:
        agentPool: $(agentPool)
        pythonVersion: 3.10
        env: ${{ parameters.env }}
        mainRepositoryName: 'ARIAMigration-Databrick'
        databricksInstance: 'https://adb-3635282203417052.12.azuredatabricks.net'
        databricksClusterId: ${{ parameters.databricksClusterId }}
    - template: pipeline/jobs/deploy.yaml
      displayName: Deploy
      dependsOn: Configure
      parameters:
        agentPool: $(agentPool)
        pythonVersion: 3.10
        env: ${{ parameters.env }}
        mainRepositoryName: 'ARIAMigration-Databrick'
        databricksInstance: 'https://adb-3635282203417052.12.azuredatabricks.net'