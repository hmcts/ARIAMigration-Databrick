resources:
  clusters:
    DAB_JobCluster:
      apply_policy_default_values: false
      autoscale:
        min_workers: 2
        max_workers: 8
        target_workers: 2
      azure_attributes:
        first_on_demand: 1
        availability: ON_DEMAND_AZURE
        spot_bid_max_price: -1 
      autotermination_minutes: 120
      cluster_name: 'DAB_JobCluster'
      data_security_mode: "LEGACY_SINGLE_USER_STANDARD"
      driver_node_type_id: "Standard_D8ads_v5"
      enable_elastic_disk: true
      enable_local_disk_encryption: false
      node_type_id: "Standard_D8ads_v5"
      runtime_engine: "STANDARD"
      spark_env_vars: 
        PYSPARK_PYTHON: "/databricks/python3/bin/python3"
      spark_version: "15.4.x-scala2.12"
      custom_tags :
        "application": "dlrm-data-ingest"
        "expiresAfter": "3000-01-01"
        "startupMode": "always"
        "autoShutdown": "true"
        "builtFrom": "hmcts/dlrm-data-ingest-infra"
        "businessArea": "cross-cutting"
        "Data-Ingest-Project": "DLRM Ingestion Engine"
        "environment": "sandbox"
        "criticality": "Low"

# Adding python wheel to shared multi-node cluster above
#resources:
#  jobs:
#    wheel-job:
#      name: wheel-job
#      tasks:
#        - task_key: wheel-task
#          job_cluster_key: DAB_JobCluster
#          python_wheel_task:
#            entry_point: main
#            package_name: wheel_package
#          libraries:
#            - whl: "../Databricks/SharedFunctionsLib/dist/ARIAFUNCITONS-0.0.1-py3-none-any.whl"

resources:
  jobs:
    wheel-job:
      name: wheel-job
      job_clusters:
        - job_cluster_key: DAB_job_cluster
          new_cluster:
            spark_version: 15.4.x-scala2.12
            node_type_id: Standard_D8ads_v5
            num_workers: 2

      tasks:
        - task_key: run-my-wheel
          job_cluster_key: DAB_job_cluster
          python_wheel_task:
            entry_point: main
            package_name: shared_functions
          libraries:
            - whl: "dbfs:/FileStore/shared_wheels/ariafunctions-0.0.1-py3-none-any.whl"