parameters:
  pythonVersion: ''
  env: ''
  mainRepositoryName: ''


steps:
- task: AzureCLI@2
  displayName: 'Install python ${{ parameters.pythonVersion }}'
  inputs:
    azureSubscription: 'DTS-DATAINGEST-${{ upper(parameters.env) }}'
    scriptType: bash
    scriptLocation: inlineScript
    inlineScript: |
      set -x
      apt-get update
      ACCEPT_EULA=Y apt-get -y install python${{ parameters.pythonVersion }} python3-dev python3-pip
      python${{ parameters.pythonVersion }} --version
      python${{ parameters.pythonVersion }} -m venv working_dir
      source working_dir/bin/activate
      export PYTHONPATH="${PYTHONPATH}:/./"
      python${{ parameters.pythonVersion }} -m pip install -U pip
      curl -fsSL https://raw.githubusercontent.com/databricks/setup-cli/main/install.sh | sh
      databricks version
    workingDirectory: '$(System.DefaultWorkingDirectory)'