parameters:
- name: runTests
  type: boolean
  default: true
- name: env
  displayName: Environment
  type: string
  default: 'sbox'
  values:
  - sbox

name: ARIA Data Migration CI Pipeline - ${{ parameters.env }}
trigger:
- master

variables:
  resourceGroupName: ingest00-main-${{ parameters.env }}
  agentPool: hmcts-ss-${{ parameters.env }}
  ${{ if eq(parameters.env, 'prod') }}:
      runTests: false
  ${{ else }}:
      runTests: true

stages:
- ${{ if or(eq(variables['Build.SourceBranch'], 'refs/heads/main'), startsWith(variables['Build.SourceBranch'], 'refs/pull/')) }}:
  - stage: Test Permissions
    displayName: 'Test Agent Permissions'
    jobs:
    - template: pipeline/jobs/test_perms.yaml
      parameters:
        pythonVersion: 3.10